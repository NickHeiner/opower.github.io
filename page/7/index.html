<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Opower Engineering Blog">
        <meta name="author" content="Opower's Engineering Team">

        <link rel="alternate" type="application/rss+xml" title="Opower Engineering Blog" href="/feed.xml" />

        <title>Opower | Engineering Blog</title>

        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="/css/bootstrap.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Pluggy Font -->
        <link rel="stylesheet" href="/css/pluggyfont.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/custom.css">

    </head>

    <body>

    <!-- Wraps page content to push the footer down -->
    <div id="wrap">

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">OP<b>O</b>WER</a>
                <div class="nav-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/">Home</a></li>
                        <li><a href="/archive.html">Archive</a></li>
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-lg-8">

                <div class="page-header">
  <h1>Blog Posts</h1>
</div>
<div class="posts">
  
  <div class="post">
      <h2><a href="/2009/10/15/tweaking-the-agile-calendar">Tweaking the Agile Calendar</a></h2>
      <p class="meta pull-right">Written on October 15, 2009 by tom.vaughan</p>
      <div class="clearfix"></div>
      <div class="post-content">
      <p>For the first five iterations, the dev team had been following this schedule:</p>

<ul>
  <li>Iteration N, Week 1 = Design for iteration N and 2nd week of QA for iteration N-1</li>
  <li>Iteration N, Week 2 = Development</li>
  <li>Iteration N, Week 3 = Development</li>
  <li>Iteration N, Week 4 = 1st week of QA for iteration N</li>
  <li>Iteration N, Week 5 / Iteration N +1, Week 1 = 2nd week of QA for iteration N, design for iteration N + 1</li>
</ul>

<p>We started to notice a couple things that have caused us to try out a new schedule in our upcoming 6th iteration.</p>

<p>First, we realized that we left very little time for fit to hit the shan.  If we had a tough QA cycle, we didn’t design enough.  If we didn’t design enough, we underestimated how much development would be needed (i.e. too many story points).  If we had too many story points, we’d go in to QA late.  And the cycle repeats.</p>

<p>Note that many of you Agile purists out there will cringe at the above description, especially this sentence: “If we had too many story points, we’d go in to QA late.”</p>

<p>I know.  We cringed too.</p>

<p>We’re committing to a couple new explicit practices going in to our next iterations:</p>

<ol>
  <li>More formal velocity check-ins.  If less than 50% of our story points are closed by COB of the first Friday, we should have a come-to-jeebus meeting on Monday morning.</li>
  <li>We absolutely need to respect the impact that dedicated design time has on the effectiveness of everything down-stream.  It’s too easy to say “Agile” as a synonym for “code by the seat of your pants,” but that’s not what it’s about and we know that.  We just need to get better at dedicating time to it.</li>
</ol>

<p>So with those ideas in mind, we’re moving to something like the following:</p>

<p><img src="/img/iteration_detail_screenprint_cropped.png" alt="iteration_detail_screenprint_cropped" /></p>

<p>It’s a five-week iteration, with 2 solid weeks built in for QA and 1 dedicated week of design.</p>

<p>I think if we can get to a point where our regression and automation testing is good enough (and we develop enough confidence our automated tests), that we may be able to get back to a 4 week cycle.  In the mean time, we’re going to see if we can actually go faster by slowing down.</p>

<p>Stay tuned!</p>

      </div>
  </div>
  
  <div class="post">
      <h2><a href="/2009/10/15/agile-impressions-5-iterations-in">Agile impressions, 5 iterations in...</a></h2>
      <p class="meta pull-right">Written on October 15, 2009 by tom.vaughan</p>
      <div class="clearfix"></div>
      <div class="post-content">
      <p>I’m assuming from the amount of hype out there that if a development team isn’t using “Agile” right now, they probably feel like the one kid on the block who didn’t have a Nintendo (with the Duck Hunt option, of course).</p>

<p><img src="/img/duckhunt-300x165.png" alt="duckhunt" /></p>

<p>Well, we here at OPOWER loved our Duck Hunt, so we’ve been attempting to use “Agile” for the last 5 months or so.  Agile means a lot of things to a lot of people, so I’ll spell out what it means for us and then reflect on some of the pros, cons, and room-for-improvement in our practice.</p>

<ul>
  <li>&lt;cringe&gt;Embrace change&lt;/cringe&gt; (duh)…but especially in this startup environment, we need to remember to do no more than is necessary, because any “extra mile” functionality is likely to be totally unused as priorities and direction changes.</li>
  <li>Be scientific about development…<a href="/2009/08/19/measuring-our-awesomeness-iteration-by-iteration">measure, measure measure</a>.  We track velocities, average-open-days-per-bug-by-severity, etc.</li>
  <li>“Individuals and interactions over processes and tools”…we self-organize, aren’t afraid to try new combinations of responsibilities and assignments, provide regular feedback to each other and we don’t dictate a development environment or technology stack.</li>
</ul>

<p>The best thing about the technical side of this company is that the entire development team and project management team is on-board with the idea of rapid iterations, continuous improvement and a focus on technical excellent and “maximizing the amount of work not done.”</p>

<p>This manifests itself in several practices that I’d chalk up in the “pro” column:</p>

<ul>
  <li>Light weight documentation…use wikis and person-to-person contact (recorded on bug tickets for posterity) to flush out designs and requirement.</li>
  <li>Continuous integration and continuous improvement (we just installed Sonar last week…we’ll blog about its effectiveness later)</li>
  <li>Regular code reviews, 360 reviews, and “how did we collectively perform this iteration” meetings</li>
  <li>Few formal meetings, many informal, impromptu “drive bys”</li>
</ul>

<p><strong>But the best thing about our Agile environment</strong> right now is that it is a work-in-progress “process framework” that repeats quickly enough for us to remember what to improve.</p>

<p>What do I mean by that?</p>

<p>It’s my impression that on the longer, more drawn-out software engagements (say…6 or 12 months), you can make a series of mistakes in the design phase, the build phase, the qa phase, etc. and then by the time you’re on the next project you repeat all those mistakes again because it’s been 6 or 12 months since you last learned your lesson.  Instead of concrete lessons, you develop a career full of “gut instincts.”</p>

<p>We’re still honing in on the right amount of measurement and process for OPOWER, but because we’re all on board with the idea of quick-hit iterations with a continuous focus on improvement, I have high hopes for our ability to become (stay?) a top-notch software engineering organization.</p>

<p><img src="/img/duckhunt_many-300x213.png" alt="duckhunt_many" /></p>

<p>There’s lots of room for improvement, that I think I’ll save for another post on another day.  We could definitely stand to “communicate out” more – with the product team and with our operations team.  We need to do a better job of making sure our iterations are lining up with the corporate strategy.  We could improve on the whole “customer collaboration over contract negotiation” part of the manifesto.  But you can only squeeze that trigger so fast, right?</p>

      </div>
  </div>
  
  <div class="post">
      <h2><a href="/2009/09/18/best-javadoc-ever">Best javadoc ever</a></h2>
      <p class="meta pull-right">Written on September 18, 2009 by yoni.ben-meshulam</p>
      <div class="clearfix"></div>
      <div class="post-content">
      <pre><code>/**
  * Whatever to satisfy whatever.
  *
  * @author dave.copeland
  */
</code></pre>


      </div>
  </div>
  
  <div class="post">
      <h2><a href="/2009/09/13/expectationstrouble">expectations==trouble</a></h2>
      <p class="meta pull-right">Written on September 13, 2009 by yoni.ben-meshulam</p>
      <div class="clearfix"></div>
      <div class="post-content">
      <p><img src="/img/wtf_javascript.png" alt="expectations will get you in trouble :)" /></p>

      </div>
  </div>
  
  <div class="post">
      <h2><a href="/2009/09/10/when-is-a-null-not-a-null">When is a null not a null?</a></h2>
      <p class="meta pull-right">Written on September 10, 2009 by tom.vaughan</p>
      <div class="clearfix"></div>
      <div class="post-content">
      <p>tl/dr: <em>Don’t have a non-null object’s .toString() display “null”. It’s confusing and not helpful when looking at object states in IDE debuggers.</em></p>

<p>I recently converted the attribute of our Person POJO that stored a user’s email address from a java.lang.String to a javax.mail.InternetAddress.  Call it not enough testing or lack of imagination, but I introduced a Null Pointer Exception in a back-office web flow where a new user is created for our customer service application.  When a new CSR account is created and the email address is left blank, an NPE gets thrown up.  Embarrassing, but easy to fix, right?</p>

<p>Just looking at the stack trace narrows it down immediately:</p>

<pre><code>2009-09-09 16:56:53,636 WARN  [btpool0-1] [REPORT] [WARN] Handler execution resulted in exception
java.lang.NullPointerException
	at javax.mail.internet.InternetAddress.parse(InternetAddress.java:609)
	at javax.mail.internet.InternetAddress.parse(InternetAddress.java:569)
	at javax.mail.internet.InternetAddress.(InternetAddress.java:105)
	at poscore.db.InternetAddressUserType.deepCopy(InternetAddressUserType.java:93)
	at org.hibernate.type.CustomType.deepCopy(CustomType.java:179)
	at org.hibernate.type.TypeFactory.deepCopy(TypeFactory.java:374)
</code></pre>

<p>Ahh…yeah…that custom hibernate type I wrote to translate VARCHARs to InternetAddresses and vice versa.  Ok, what does that deep copy method look like?</p>

<div class="highlight"><pre><code class="java">    
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">deepCopy</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">HibernateException</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">InternetAddress</span> <span class="n">original</span> <span class="o">=</span> <span class="o">(</span><span class="n">InternetAddress</span><span class="o">)</span><span class="n">value</span><span class="o">;</span>
    <span class="n">InternetAddress</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="n">original</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">AddressException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">HibernateException</span><span class="o">(</span><span class="s">&quot;Unable to deep copy email address &#39;&quot;</span> <span class="o">+</span> <span class="n">original</span><span class="o">.</span><span class="na">getAddress</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>

<p>It turns out, the error is right here:</p>

<div class="highlight"><pre><code class="java"><span class="n">copy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="n">original</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span>
</code></pre></div>

<p>You can’t pass a null to the InternetAddress constructor.  It was late in the day and I must not have internalized that there’s no way <em>value</em> or <em>original</em> could be null, because my first instinct was that the NPE was actually the result of calling “.getAddress()” on a null <em>original</em> object….not that the constructor can’t take a null.</p>

<p>While I was on that assumption (that it was the <em>original</em> object that was null), I fired up my debugger and got confused by what appeared to be null-checks failing to check nulls. Check out this screen shot of the NPE about to be thrown after what appears to be 2 null checks failing to prevent the NPE:</p>

<p><img src="/img/null_internet_address.png" alt="null_internet_address" /></p>

<p>The arrows marked (A) and (B) shows what appear to be null objects passing null checks (in the top pane) even though they’re being reported as null (in the bottom pane).  The green line (C) shows the code falling through to that line just before it throws up the NPE.</p>

<p>Of course, <em>value</em> and <em>original</em> aren’t null at all…it’s just that their .toString() methods report them to be null.  Here’s the InternetAddress.toString method:</p>

<pre><code>276   public String toString() {
277       if (encodedPersonal == null &amp;&amp; personal != null)
278           try {
279	              encodedPersonal = MimeUtility.encodeWord(personal);
280           } catch (UnsupportedEncodingException ex) { }
281
282       if (encodedPersonal != null)
283           return quotePhrase(encodedPersonal) + " &lt;" + address + "&gt;";
284       else if (isGroup() || isSimple())
285           return address;
286       else
287           return "&lt;" + address + "&gt;";
288   }
</code></pre>

<p>In my situation, I fell in to the <code>else if(isGroup() || isSimple())</code> case, which returns <code>address</code>, which is null, so the <code>.toString()</code> for the whole InternetAddress object is “null.”</p>

<p>I think the toString() method could benefit from another null-check right at line 284, which would mean an InternetAddress object with a null internal <code>address</code> String would display as “&lt;null&gt;” …that’s a more immediate clue that the object itself isn’t null.</p>

      </div>
  </div>
  
</div>

<ul class="pager">
  
  <li class="previous"><a href="/page/8">&larr; Older</a></li>
  
  
  <li class="next"><a href="/page/6">Newer &rarr;</a></li>
  
</ul>


                </div>
                <div class="sidebar col-lg-4">
                    <div class="panel">
                        <div class="panel-heading">
                            <h3 class="panel-title">Opower Projects</h3>
                        </div>
                        <ul class="list-group project-list">
                            <li class="project list-group-item" repo="opower/elroi"></li>
                            <li class="project list-group-item" repo="opower/sensu-metrics-relay"></li>
                            <li class="project list-group-item" repo="opower/jpile"></li>
                        </ul> <!-- /.list-group -->
                    </div> <!-- /.panel -->
                    <div class="panel">
                        <div class="panel-heading">
                            <h3 class="panel-title">Personal Projects</h3>
                        </div>
                        <ul class="list-group project-list">
                            <li class="project list-group-item" repo="dylang/shortid"></li>
                            <li class="project list-group-item" repo="seancolyer/gmail-crypt"></li>
                        </ul> <!-- /.list-group -->
                    </div> <!-- /.panel -->
                </div>

            </div>
        </div><!-- /.container -->

    </div><!-- /#wrap -->

    <div id="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    &copy; 2013 <a href="http://opower.com">Opower</a> &reg;
                    All content represents the opinion of the author and does not represent Opower.<br/>
                    <a href="http://opower.com/company/privacy-policy/">Privacy</a> :
                    <a href="http://opower.com/company/terms/">Terms</a>
                </div>
                <div class="col-lg-6">
                    <ul class="pull-right">
                        <li><a href="http://github.com/opower">Github</a></li>
                        <li><a href="http://twitter.com/opower">Twitter</a></li>
                        <li><a href="http://www.linkedin.com/company/opower">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

  </body>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="/js/live-repos.js"></script>
</html>
